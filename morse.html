<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desaf√≠o de la C√°tedra - C√≥digo Morse</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --blue-400: #60a5fa;
            --blue-500: #3b82f6;
            --blue-600: #2563eb;
            --blue-300: #93c5fd;
            --green-400: #4ade80;
            --green-500: #22c55e;
            --green-600: #16a34a;
            --red-400: #f87171;
            --red-500: #ef4444;
            --red-600: #dc2626;
            --slate-800: #1e293b;
            --slate-900: #0f172a;
            --white: #ffffff;
            --white-20: rgba(255, 255, 255, 0.2);
            --white-30: rgba(255, 255, 255, 0.3);
            --black-60: rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--blue-400), var(--blue-500), var(--blue-600));
            color: var(--white);
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .top-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .btn-exit {
            background-color: rgba(239, 68, 68, 0.8);
            color: var(--white);
            border: 1px solid rgba(248, 113, 113, 0.3);
        }

        .btn-exit:hover {
            background-color: rgba(220, 38, 38, 0.8);
        }

        .btn-info {
            background-color: var(--white-20);
            color: var(--white);
            border: 1px solid var(--white-30);
        }

        .btn-info:hover {
            background-color: var(--white-30);
        }

        .btn-primary {
            background-color: var(--blue-600);
            color: var(--white);
            font-weight: bold;
            width: 100%;
            padding: 0.75rem;
            justify-content: center;
        }

        .btn-primary:hover {
            background-color: var(--blue-500);
        }

        .btn-green {
            background-color: var(--green-600);
            color: var(--white);
            font-weight: bold;
            width: 100%;
            padding: 0.75rem;
        }

        .btn-green:hover {
            background-color: var(--green-500);
        }

        .btn-red {
            background-color: var(--red-600);
            color: var(--white);
            font-weight: bold;
            width: 100%;
            padding: 0.75rem;
        }

        .btn-red:hover {
            background-color: var(--red-500);
        }

        .btn-gray {
            background-color: var(--slate-800);
            color: var(--white);
            font-weight: bold;
            width: 100%;
            padding: 0.75rem;
        }

        .btn-gray:hover {
            background-color: #334155;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--black-60);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 1rem;
        }

        .modal {
            background-color: var(--slate-800);
            border-radius: 0.5rem;
            padding: 1.5rem;
            max-width: 28rem;
            width: 100%;
            border: 1px solid rgba(59, 130, 246, 0.5);
        }

        .modal h3 {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--blue-300);
            margin-bottom: 1rem;
        }

        .modal p {
            color: var(--blue-300);
            margin-bottom: 1.5rem;
        }

        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .info-panel {
            background-color: var(--white-20);
            backdrop-filter: blur(10px);
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid var(--white-30);
            margin-bottom: 1.5rem;
        }

        .info-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .info-header h3 {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
        }

        .close-btn:hover {
            color: var(--blue-300);
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.25rem;
            font-weight: bold;
            color: var(--white);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
        }

        .stage-container {
            background-color: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid var(--white-30);
        }

        .stage-container p {
            color: var(--blue-300);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .puzzle-grid {
            background-color: rgba(15, 23, 42, 0.5);
            border-radius: 0.25rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .grid-2-col {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }

        .grid-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--slate-800);
            padding: 0.75rem;
            border-radius: 0.25rem;
        }

        .grid-pos {
            color: var(--blue-300);
            font-weight: bold;
        }

        .grid-morse {
            color: var(--green-400);
            font-size: 1.125rem;
        }

        .toggle-hint {
            color: var(--white);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            text-decoration: underline;
            font-weight: 500;
        }

        .toggle-hint:hover {
            color: var(--blue-300);
        }

        .morse-table {
            background-color: rgba(15, 23, 42, 0.7);
            border-radius: 0.25rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            max-height: 16rem;
            overflow-y: auto;
        }

        .morse-table h3 {
            color: var(--blue-300);
            font-weight: bold;
            margin-bottom: 0.75rem;
        }

        .grid-3-col {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }

        .morse-item {
            display: flex;
            justify-content: space-between;
            background-color: var(--slate-800);
            padding: 0.5rem;
            border-radius: 0.25rem;
        }

        .morse-letter {
            color: var(--blue-400);
            font-weight: bold;
        }

        .morse-code {
            color: var(--green-400);
        }

        .input-group {
            margin-top: 1rem;
        }

        .input-group label {
            color: var(--white);
            font-weight: 500;
            display: block;
            margin-bottom: 0.5rem;
        }

        .input-field {
            width: 100%;
            background-color: var(--slate-900);
            border: 1px solid rgba(59, 130, 246, 0.5);
            border-radius: 0.25rem;
            padding: 0.75rem 1rem;
            color: var(--white);
            margin-bottom: 1rem;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--blue-400);
        }

        .feedback {
            margin-top: 1rem;
            border-radius: 0.25rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .feedback-success {
            background-color: rgba(34, 197, 94, 0.2);
            border: 1px solid var(--green-500);
        }

        .feedback-success p {
            color: var(--green-400);
            margin-bottom: 0;
        }

        .feedback-error {
            background-color: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--red-500);
        }

        .feedback-error p {
            color: var(--red-400);
            margin-bottom: 0;
        }

        .question-container {
            margin-top: 1rem;
        }

        .question-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--white);
            margin-bottom: 1rem;
        }

        .question-option {
            width: 100%;
            text-align: left;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid;
            margin-bottom: 0.75rem;
            background-color: rgba(15, 23, 42, 0.5);
            color: var(--white);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .question-option:hover:not(:disabled) {
            border-color: var(--blue-500);
            background-color: rgba(15, 23, 42, 0.7);
        }

        .question-option:disabled {
            cursor: not-allowed;
        }

        .option-selected-correct {
            background-color: rgba(34, 197, 94, 0.2);
            border-color: var(--green-500);
        }

        .option-selected-incorrect {
            background-color: rgba(239, 68, 68, 0.2);
            border-color: var(--red-500);
        }

        .option-letter {
            color: var(--blue-300);
            font-weight: bold;
            font-size: 1.125rem;
        }

        .option-morse {
            color: var(--green-400);
            font-family: 'Courier New', monospace;
            font-size: 1.125rem;
            flex: 1;
            margin-left: 1rem;
        }

        .victory-container {
            text-align: center;
            background: linear-gradient(90deg, rgba(34, 197, 94, 0.2), rgba(59, 130, 246, 0.2));
            backdrop-filter: blur(10px);
            border-radius: 0.5rem;
            padding: 2rem;
            border: 1px solid rgba(34, 197, 94, 0.5);
        }

        .victory-emoji {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .victory-title {
            font-size: 1.875rem;
            font-weight: bold;
            color: var(--green-400);
            margin-bottom: 1rem;
        }

        .victory-message {
            color: var(--blue-300);
            font-size: 1.25rem;
        }

        .space-y-3 > * + * {
            margin-top: 0.75rem;
        }

        .space-y-6 > * + * {
            margin-top: 1.5rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-6 {
            margin-bottom: 1.5rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mt-6 {
            margin-top: 1.5rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-2xl {
            font-size: 1.5rem;
        }

        .text-3xl {
            font-size: 1.875rem;
        }

        .text-4xl {
            font-size: 2.25rem;
        }

        .font-bold {
            font-weight: bold;
        }

        .font-medium {
            font-weight: 500;
        }

        .italic {
            font-style: italic;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.75rem;
            }
            
            .grid-2-col, .grid-3-col {
                grid-template-columns: 1fr;
            }
            
            .question-title {
                font-size: 1.25rem;
            }
            
            .option-morse {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Botones superiores -->
        <div class="top-buttons">
            <button id="exitBtn" class="btn btn-exit">
                <i class="fas fa-sign-out-alt"></i>
                <span>Salir</span>
            </button>
            
            <button id="infoBtn" class="btn btn-info">
                <i class="fas fa-book"></i>
                <span>Informaci√≥n</span>
            </button>
        </div>

        <!-- Modal de salida -->
        <div id="exitModal" class="modal-overlay hidden">
            <div class="modal">
                <h3>¬øDeseas salir?</h3>
                <p>¬øQuieres guardar tu progreso antes de salir?</p>
                <div class="modal-buttons">
                    <button id="saveAndExitBtn" class="btn btn-green">Guardar y salir</button>
                    <button id="exitWithoutSavingBtn" class="btn btn-red">Salir sin guardar</button>
                    <button id="cancelExitBtn" class="btn btn-gray">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Panel de informaci√≥n -->
        <div id="infoPanel" class="info-panel hidden">
            <div class="info-header">
                <h3>
                    <i class="fas fa-book"></i>
                    Informaci√≥n del Reto
                </h3>
                <button id="closeInfoBtn" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="text-white space-y-3">
                <p class="italic">Informaci√≥n disponible pr√≥ximamente...</p>
                <!-- Aqu√≠ puedes a√±adir la informaci√≥n que necesites m√°s adelante -->
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <h1>Desaf√≠o de la C√°tedra</h1>
            <p>Descifra el c√≥digo morse</p>
        </div>

        <!-- Contenido principal -->
        <div id="gameContent">
            <!-- Stage 1: Puzzle inicial -->
            <div id="stage1" class="stage-container">
                <p>"Tenemos la informaci√≥n sobre la c√°tedra, pero nos falta el nombre del lugar en el que se construy√≥, aunque aqu√≠ hay algo m√°s:"</p>
                
                <div class="puzzle-grid">
                    <div class="grid-2-col" id="puzzleClues">
                        <!-- Las pistas se cargar√°n con JavaScript -->
                    </div>
                </div>

                <button id="toggleHintBtn" class="toggle-hint">
                    Ver tabla de c√≥digo morse
                </button>

                <div id="hintPanel" class="morse-table hidden">
                    <h3>C√≥digo Morse Internacional</h3>
                    <div class="grid-3-col" id="morseTable">
                        <!-- La tabla morse se cargar√° con JavaScript -->
                    </div>
                </div>

                <div class="input-group">
                    <label for="answerInput">Introduce el nombre del lugar:</label>
                    <input type="text" id="answerInput" class="input-field" placeholder="Escribe tu respuesta...">
                    <button id="submitAnswerBtn" class="btn btn-primary">Comprobar</button>
                </div>

                <div id="stage1Feedback" class="feedback hidden"></div>
            </div>

            <!-- Stage 2: Pregunta m√∫ltiple -->
            <div id="stage2" class="stage-container hidden">
                <h2 class="question-title">¬øEn qu√© a√±o se form√≥ la alianza entre la Universidad de Alicante y Aguas de Alicante?</h2>

                <button id="toggleHintBtn2" class="toggle-hint">
                    Ver tabla de c√≥digo morse
                </button>

                <div id="hintPanel2" class="morse-table hidden">
                    <h3>C√≥digo Morse Internacional</h3>
                    <div class="grid-3-col" id="morseTable2">
                        <!-- La tabla morse se cargar√° con JavaScript -->
                    </div>
                </div>

                <div class="question-container space-y-3" id="questionsContainer">
                    <!-- Las preguntas se cargar√°n con JavaScript -->
                </div>

                <div id="stage2Feedback" class="feedback hidden"></div>
            </div>

            <!-- Stage 3: Victoria -->
            <div id="stage3" class="hidden">
                <div class="victory-container">
                    <div class="victory-emoji">üéâ</div>
                    <h2 class="victory-title">¬°De loquetes loquetes!</h2>
                    <p class="victory-message">Has descifrado el c√≥digo correctamente</p>
                    <button id="playAgainBtn" class="btn btn-primary mt-6">Jugar de nuevo</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos del juego
        const morseTable = {
            'A': '‚Ä¢ ‚Äî', 'B': '‚Äî ‚Ä¢ ‚Ä¢ ‚Ä¢', 'C': '‚Äî ‚Ä¢ ‚Äî ‚Ä¢', 'D': '‚Äî ‚Ä¢ ‚Ä¢',
            'E': '‚Ä¢', 'F': '‚Ä¢ ‚Ä¢ ‚Äî ‚Ä¢', 'G': '‚Äî ‚Äî ‚Ä¢', 'H': '‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢',
            'I': '‚Ä¢ ‚Ä¢', 'J': '‚Ä¢ ‚Äî ‚Äî ‚Äî', 'K': '‚Äî ‚Ä¢ ‚Äî', 'L': '‚Ä¢ ‚Äî ‚Ä¢ ‚Ä¢',
            'M': '‚Äî ‚Äî', 'N': '‚Äî ‚Ä¢', 'O': '‚Äî ‚Äî ‚Äî', 'P': '‚Ä¢ ‚Äî ‚Äî ‚Ä¢',
            'Q': '‚Äî ‚Äî ‚Ä¢ ‚Äî', 'R': '‚Ä¢ ‚Äî ‚Ä¢', 'S': '‚Ä¢ ‚Ä¢ ‚Ä¢', 'T': '‚Äî',
            'U': '‚Ä¢ ‚Ä¢ ‚Äî', 'V': '‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Äî', 'W': '‚Ä¢ ‚Äî ‚Äî', 'X': '‚Äî ‚Ä¢ ‚Ä¢ ‚Äî',
            'Y': '‚Äî ‚Ä¢ ‚Äî ‚Äî', 'Z': '‚Äî ‚Äî ‚Ä¢ ‚Ä¢',
            '0': '‚Äî ‚Äî ‚Äî ‚Äî ‚Äî', '1': '‚Ä¢ ‚Äî ‚Äî ‚Äî ‚Äî', '2': '‚Ä¢ ‚Ä¢ ‚Äî ‚Äî ‚Äî',
            '3': '‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Äî ‚Äî', '4': '‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Äî', '5': '‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢',
            '6': '‚Äî ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢', '7': '‚Äî ‚Äî ‚Ä¢ ‚Ä¢ ‚Ä¢', '8': '‚Äî ‚Äî ‚Äî ‚Ä¢ ‚Ä¢', '9': '‚Äî ‚Äî ‚Äî ‚Äî ‚Ä¢'
        };

        const puzzleClues = [
            { pos: 2, morse: '‚Äî ‚Äî ‚Äî' },
            { pos: 5, morse: '‚Äî ‚Äî ‚Äî' },
            { pos: 7, morse: '‚Äî ‚Äî ‚Äî' },
            { pos: 3, morse: '‚Äî ‚Ä¢ ‚Äî' },
            { pos: 1, morse: '‚Äî ‚Ä¢' },
            { pos: 6, morse: '‚Äî ‚Äî ‚Äî' },
            { pos: 0, morse: '‚Äî ‚Äî ‚Äî' },
            { pos: 4, morse: '‚Ä¢ ‚Äî' }
        ];

        const questions = [
            { letter: 'A', morse: '‚Äî ‚Äî ‚Äî ‚Üê   ‚Äî ‚Äî ‚Äî ‚Üí   ‚Äî ‚Äî ‚Äî ‚Üê   ‚Äî ‚Äî ‚Äî', decoded: '2022' },
            { letter: 'B', morse: '‚Äî ‚Ä¢   ‚Ä¢ ‚Äî   ‚Äî ‚Äî ‚Äî ‚Üí   ‚Äî ‚Äî ‚Äî ‚Üê', decoded: '1942' },
            { letter: 'C', morse: '‚Äî ‚Äî ‚Äî ‚Üê   ‚Äî ‚Äî ‚Äî ‚Üê   ‚Äî ‚Äî ‚Äî ‚Üê   ‚Äî ‚Äî ‚Äî ‚Üí', decoded: '2222' },
            { letter: 'D', morse: '‚Äî ‚Äî ‚Äî ‚Üí   ‚Ä¢ ‚Äî   ‚Äî ‚Äî ‚Äî ‚Üê   ‚Äî ‚Äî ‚Äî', decoded: '5420' }
        ];

        // Estado del juego
        let stage = 1;
        let userInput = '';
        let showHint = false;
        let showHint2 = false;
        let selectedAnswer = null;
        let showFeedback = false;
        let showInfo = false;
        let showExitModal = false;

        // Elementos del DOM
        const stage1El = document.getElementById('stage1');
        const stage2El = document.getElementById('stage2');
        const stage3El = document.getElementById('stage3');
        const answerInputEl = document.getElementById('answerInput');
        const submitAnswerBtn = document.getElementById('submitAnswerBtn');
        const stage1FeedbackEl = document.getElementById('stage1Feedback');
        const stage2FeedbackEl = document.getElementById('stage2Feedback');
        const questionsContainerEl = document.getElementById('questionsContainer');
        const puzzleCluesEl = document.getElementById('puzzleClues');
        const morseTableEl = document.getElementById('morseTable');
        const morseTable2El = document.getElementById('morseTable2');
        const hintPanelEl = document.getElementById('hintPanel');
        const hintPanel2El = document.getElementById('hintPanel2');
        const toggleHintBtn = document.getElementById('toggleHintBtn');
        const toggleHintBtn2 = document.getElementById('toggleHintBtn2');
        const exitBtn = document.getElementById('exitBtn');
        const infoBtn = document.getElementById('infoBtn');
        const exitModalEl = document.getElementById('exitModal');
        const infoPanelEl = document.getElementById('infoPanel');
        const closeInfoBtn = document.getElementById('closeInfoBtn');
        const saveAndExitBtn = document.getElementById('saveAndExitBtn');
        const exitWithoutSavingBtn = document.getElementById('exitWithoutSavingBtn');
        const cancelExitBtn = document.getElementById('cancelExitBtn');
        const playAgainBtn = document.getElementById('playAgainBtn');

        // Inicializar el juego
        function initGame() {
            renderPuzzleClues();
            renderMorseTable();
            renderQuestions();
            
            // Configurar event listeners
            setupEventListeners();
            
            // Mostrar solo la etapa 1 al inicio
            showStage(1);
        }

        // Mostrar una etapa espec√≠fica
        function showStage(stageNumber) {
            stage1El.classList.add('hidden');
            stage2El.classList.add('hidden');
            stage3El.classList.add('hidden');
            
            if (stageNumber === 1) {
                stage1El.classList.remove('hidden');
            } else if (stageNumber === 2) {
                stage2El.classList.remove('hidden');
            } else if (stageNumber === 3) {
                stage3El.classList.remove('hidden');
            }
            
            stage = stageNumber;
        }

        // Renderizar las pistas del puzzle
        function renderPuzzleClues() {
            puzzleCluesEl.innerHTML = '';
            puzzleClues.forEach(clue => {
                const clueEl = document.createElement('div');
                clueEl.className = 'grid-item';
                clueEl.innerHTML = `
                    <span class="grid-pos">${clue.pos}:</span>
                    <span class="grid-morse">${clue.morse}</span>
                `;
                puzzleCluesEl.appendChild(clueEl);
            });
        }

        // Renderizar la tabla de c√≥digo morse
        function renderMorseTable() {
            morseTableEl.innerHTML = '';
            morseTable2El.innerHTML = '';
            
            Object.entries(morseTable).forEach(([letter, code]) => {
                const morseItem = document.createElement('div');
                morseItem.className = 'morse-item';
                morseItem.innerHTML = `
                    <span class="morse-letter">${letter}</span>
                    <span class="morse-code">${code}</span>
                `;
                morseTableEl.appendChild(morseItem.cloneNode(true));
                morseTable2El.appendChild(morseItem.cloneNode(true));
            });
        }

        // Renderizar las preguntas de opci√≥n m√∫ltiple
        function renderQuestions() {
            questionsContainerEl.innerHTML = '';
            questions.forEach(q => {
                const questionBtn = document.createElement('button');
                questionBtn.className = 'question-option';
                questionBtn.dataset.letter = q.letter;
                questionBtn.innerHTML = `
                    <div class="flex items-center justify-between">
                        <span class="option-letter">${q.letter})</span>
                        <span class="option-morse">${q.morse}</span>
                    </div>
                `;
                
                questionBtn.addEventListener('click', () => handleAnswerSelect(q.letter));
                questionsContainerEl.appendChild(questionBtn);
            });
        }

        // Manejar la selecci√≥n de respuesta en la etapa 2
        function handleAnswerSelect(letter) {
            if (showFeedback) return;
            
            selectedAnswer = letter;
            showFeedback = true;
            
            // Actualizar la apariencia de los botones
            document.querySelectorAll('.question-option').forEach(btn => {
                const btnLetter = btn.dataset.letter;
                btn.disabled = true;
                
                if (btnLetter === letter) {
                    btn.classList.add(letter === 'C' ? 'option-selected-correct' : 'option-selected-incorrect');
                    
                    // Mostrar icono de check o X
                    const icon = document.createElement('i');
                    icon.className = letter === 'C' ? 'fas fa-check' : 'fas fa-times';
                    icon.style.color = letter === 'C' ? '#4ade80' : '#f87171';
                    icon.style.marginLeft = '0.5rem';
                    btn.querySelector('.flex').appendChild(icon);
                }
            });
            
            // Mostrar feedback
            if (letter === 'C') {
                stage2FeedbackEl.className = 'feedback feedback-success';
                stage2FeedbackEl.innerHTML = `
                    <i class="fas fa-check" style="color: var(--green-400);"></i>
                    <div>
                        <p class="font-bold mb-2">¬°Correcto!</p>
                        <p class="text-sm">
                            El c√≥digo morse con las flechas indica: ‚Üê = resta 1, ‚Üí = suma 1
                            <br>
                            Opci√≥n C: 2(‚Üê)=1, 2(‚Üê)=1, 2(‚Üê)=1, 2(‚Üí)=3 = A√±o 1113... ¬°Espera! 
                            <br>
                            Realmente es: 2 - 0 - 2 - 2 = ¬°2022!
                        </p>
                    </div>
                `;
                stage2FeedbackEl.classList.remove('hidden');
                
                // Avanzar a la etapa 3 despu√©s de 2.5 segundos
                setTimeout(() => {
                    showStage(3);
                }, 2500);
            } else {
                stage2FeedbackEl.className = 'feedback feedback-error';
                stage2FeedbackEl.innerHTML = `
                    <i class="fas fa-times" style="color: var(--red-400);"></i>
                    <p>Respuesta incorrecta. Intenta seleccionar otra opci√≥n.</p>
                `;
                stage2FeedbackEl.classList.remove('hidden');
                
                // Permitir seleccionar otra respuesta despu√©s de 2 segundos
                setTimeout(() => {
                    showFeedback = false;
                    selectedAnswer = null;
                    stage2FeedbackEl.classList.add('hidden');
                    document.querySelectorAll('.question-option').forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('option-selected-correct', 'option-selected-incorrect');
                        // Remover iconos
                        const icon = btn.querySelector('i');
                        if (icon) icon.remove();
                    });
                }, 2000);
            }
        }

        // Manejar el env√≠o de la respuesta en la etapa 1
        function handleStage1Submit() {
            userInput = answerInputEl.value.trim().toLowerCase();
            
            if (userInput === 'garrig√≥s' || userInput === 'garrigos') {
                // Respuesta correcta
                stage1FeedbackEl.className = 'feedback feedback-success';
                stage1FeedbackEl.innerHTML = `
                    <i class="fas fa-check" style="color: var(--green-400);"></i>
                    <p>¬°Bien! Has descifrado el c√≥digo, pero a√∫n falta la otra parte del puzzle, a ver qu√© dice‚Ä¶</p>
                `;
                stage1FeedbackEl.classList.remove('hidden');
                
                setTimeout(() => {
                    stage1FeedbackEl.classList.add('hidden');
                    showStage(2);
                    answerInputEl.value = '';
                }, 2000);
            } else {
                // Respuesta incorrecta
                stage1FeedbackEl.className = 'feedback feedback-error';
                stage1FeedbackEl.innerHTML = `
                    <i class="fas fa-times" style="color: var(--red-400);"></i>
                    <p>Respuesta incorrecta. Intenta de nuevo.</p>
                `;
                stage1FeedbackEl.classList.remove('hidden');
                
                setTimeout(() => {
                    stage1FeedbackEl.classList.add('hidden');
                }, 2000);
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Enviar respuesta con Enter en la etapa 1
            answerInputEl.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleStage1Submit();
                }
            });
            
            // Bot√≥n de enviar respuesta en la etapa 1
            submitAnswerBtn.addEventListener('click', handleStage1Submit);
            
            // Toggle hint en la etapa 1
            toggleHintBtn.addEventListener('click', () => {
                showHint = !showHint;
                hintPanelEl.classList.toggle('hidden');
                toggleHintBtn.textContent = showHint ? 'Ocultar tabla de c√≥digo morse' : 'Ver tabla de c√≥digo morse';
            });
            
            // Toggle hint en la etapa 2
            toggleHintBtn2.addEventListener('click', () => {
                showHint2 = !showHint2;
                hintPanel2El.classList.toggle('hidden');
                toggleHintBtn2.textContent = showHint2 ? 'Ocultar tabla de c√≥digo morse' : 'Ver tabla de c√≥digo morse';
            });
            
            // Bot√≥n de salir
            exitBtn.addEventListener('click', () => {
                exitModalEl.classList.remove('hidden');
            });
            
            // Bot√≥n de informaci√≥n
            infoBtn.addEventListener('click', () => {
                infoPanelEl.classList.toggle('hidden');
            });
            
            // Cerrar panel de informaci√≥n
            closeInfoBtn.addEventListener('click', () => {
                infoPanelEl.classList.add('hidden');
            });
            
            // Botones del modal de salida
            saveAndExitBtn.addEventListener('click', () => {
                alert('Progreso guardado');
                // En una implementaci√≥n real, aqu√≠ se guardar√≠a el progreso
                // Por ahora solo redirigimos a la p√°gina principal
                window.location.href = '/';
            });
            
            exitWithoutSavingBtn.addEventListener('click', () => {
                // Salir sin guardar
                window.location.href = '/';
            });
            
            cancelExitBtn.addEventListener('click', () => {
                exitModalEl.classList.add('hidden');
            });
            
            // Bot√≥n para jugar de nuevo
            playAgainBtn.addEventListener('click', () => {
                // Reiniciar el juego
                stage = 1;
                userInput = '';
                showHint = false;
                showHint2 = false;
                selectedAnswer = null;
                showFeedback = false;
                
                // Reiniciar UI
                answerInputEl.value = '';
                stage1FeedbackEl.classList.add('hidden');
                stage2FeedbackEl.classList.add('hidden');
                hintPanelEl.classList.add('hidden');
                hintPanel2El.classList.add('hidden');
                toggleHintBtn.textContent = 'Ver tabla de c√≥digo morse';
                toggleHintBtn2.textContent = 'Ver tabla de c√≥digo morse';
                
                // Reiniciar botones de preguntas
                document.querySelectorAll('.question-option').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('option-selected-correct', 'option-selected-incorrect');
                    const icon = btn.querySelector('i');
                    if (icon) icon.remove();
                });
                
                // Mostrar etapa 1
                showStage(1);
            });
        }

        // Inicializar el juego cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
